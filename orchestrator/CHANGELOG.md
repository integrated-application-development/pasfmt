# Changelog

This file documents notable changes to the `pasfmt-orchestrator` crate.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.0.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [Unreleased]

### Fixed

- `--config-file` no longer erroneously accepts a path to a directory and searches from it for a
  `pasfmt.toml` file. It is now an error to provide a path to a directory.
- Detection of decoding errors when reading from stdin.
- Silent ignoral of non-existent paths (were being treated as globs matching no files).
- Errors on writing non-ASCII data in an ANSI encoding to a Windows Console. Now written as Unicode.

### Added

- Debug logging for time taken to format each file.
- `try_create` and `validate` functions to the type generated by the `pasfmt_config!` macro.
- Cursor tracking, via the `--cursor` CLI option.
  - `FormatterConfiguration::cursors` method provides the interface

### Removed

- `Default` trait impl for `PasFmtConfiguration`.
- Ability to override configuration on the CLI with escaped values eg (`-Ckey="\uFF"`).
- Use of `Default::default` in `PasFmtConfiguration::get_config_object` to initialise the
  configuration object defaults. Users can instead provide the defaults in the `Deserialize` impl.
- Logging of the (toml-serialised) configuration object in `PasFmtConfiguration::get_config_object`.
  Users can log the object however they want outside of this function.

## [0.3.0] - 2024-05-29

### Fixed

- Erroneous removal of BOM.
- Erroneous transcoding of UTF-16 input to UTF-8.
- Unwanted use of the replacement character when encoding. This now results in an error.

### Changed

- `--files-file` parameter to `--files-from`.

## [0.2.0] - 2024-05-07

### Fixed

- Extra trailing newline when formatting stdin to stdout.
- Incorrect encoding used for writing files with encodings inferred from a BOM.
- Incorrect encoding used in stdin/stdout mode; UTF-8 was always used, but now the configured
  encoding is respected.

### Changed

- The default encoding on Windows to be the system ANSI codepage.
- The default encoding on non-Windows platforms to be UTF-8.
- Improved handling of IO errors.

### Added

- `-C` CLI option to override configuration options.
- `--mode` CLI option which replaces the `--write` and `--verify` options.

### Removed

- short version of `--config-file` CLI option.
- `--write`/`-w` CLI option (now accessible via `--mode=files`).
- `--verify` CLI option (replaced by `--mode=check` with some differences).

## [0.1.0] - 2023-08-28

### Added

- Orchestrator to handle parallelising the reading, formatting, and writing of files.
- Configuration and command-line frameworks.
- Default command-line interface.
